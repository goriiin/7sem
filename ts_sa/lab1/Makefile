# ==============================================================================
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
# ==============================================================================

# –§–∞–π–ª –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
PPTX_FILE = preza.pptx

# –§–∞–π–ª —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
DOCX_FILE = titul.docx
IMAGE_OUTPUT = titul.png

# –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞ Typst
TYPST_FILE = main.typ
PDF_OUTPUT = main.pdf


# ==============================================================================
# –ì–ª–∞–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–¶–µ–ª–∏)
# ==============================================================================

# –¶–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ —Ç—Ä–∏ –∑–∞–¥–∞—á–∏
default: all

# –°–æ–±—Ä–∞—Ç—å –≤—Å—ë: –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é, —Ç–∏—Ç—É–ª—å–Ω–∏–∫ –∏ –æ—Ç—á–µ—Ç
all: presentation report
	@echo "\n‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã."
	@echo "   -> –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤—ã."
	@echo "   -> –¢–∏—Ç—É–ª—å–Ω—ã–π –ª–∏—Å—Ç '$(IMAGE_OUTPUT)' –≥–æ—Ç–æ–≤."
	@echo "   -> –û—Ç—á–µ—Ç '$(PDF_OUTPUT)' —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω."

# –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É—è Keynote)
presentation:
	@echo "üñºÔ∏è  –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ '$(PPTX_FILE)'..."
	@if [ ! -f "$(PPTX_FILE)" ]; then \
		echo "!!! –û—à–∏–±–∫–∞: –§–∞–π–ª '$(PPTX_FILE)' –Ω–µ –Ω–∞–π–¥–µ–Ω." >&2; exit 1; \
	fi
	python3 conv_pptx.py $(PPTX_FILE)

title:
	@echo "üìÑ‚û°Ô∏èüñºÔ∏è  –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —Ç–∏—Ç—É–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ '$(DOCX_FILE)'..."
	@if [ ! -f "$(DOCX_FILE)" ]; then \
		echo "!!! –û—à–∏–±–∫–∞: –§–∞–π–ª '$(DOCX_FILE)' –Ω–µ –Ω–∞–π–¥–µ–Ω." >&2; exit 1; \
	fi
	python3 conv_docx.py $(DOCX_FILE)

report: $(TYPST_FILE)
	@echo "üìÑ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –æ—Ç—á–µ—Ç–∞ '$(TYPST_FILE)'..."
	@if ! command -v typst &> /dev/null; then \
		echo "!!! –û—à–∏–±–∫–∞: 'typst' –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –∫–æ–º–∞–Ω–¥–æ–π 'make install-typst'" >&2; exit 1; \
	fi
	typst compile $(TYPST_FILE) $(PDF_OUTPUT)
	@echo "   -> –§–∞–π–ª '$(PDF_OUTPUT)' —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω."


# ==============================================================================
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# ==============================================================================

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Typst –∏ –ø–∞–∫–µ—Ç—ã BMSTU (–¥–ª—è Linux/macOS)
install-typst:
	@echo "üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Typst –∏ –ø–∞–∫–µ—Ç–æ–≤ BMSTU..."
	@sh <(curl -sSfL https://raw.githubusercontent.com/bmstudents/typst-bmstu/refs/heads/main/install.sh)


# ==============================================================================
# –û—á–∏—Å—Ç–∫–∞
# ==============================================================================

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	rm -rf *_images
	rm -f $(IMAGE_OUTPUT)
	rm -f $(PDF_OUTPUT)
	rm -rf .typst
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	@echo "   -> –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω."


# –û–±—ä—è–≤–ª—è–µ–º —Ü–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª–∞–º–∏
.PHONY: default all presentation title report install-typst clean